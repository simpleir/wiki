package com.simpleir.wiki.process.impl;

import static org.junit.Assert.assertEquals;

import java.io.IOException;
import java.io.StringWriter;
import java.util.Arrays;
import java.util.Iterator;
import java.util.List;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import com.simpleir.wiki.TestConfiguration;
import com.simpleir.wiki.io.ArticleExtractor;
import com.simpleir.wiki.model.Article;
import com.simpleir.wiki.process.PlainTextToPositionalIndexExtractor;
import com.simpleir.wiki.process.impl.PlainTextToPositionalIndexExtractorImpl;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(classes=TestConfiguration.class)
public class PlainTextToPositionalIndexExtractorImplTest
{
	@Autowired
	private PlainTextToPositionalIndexExtractor plainTextToPositionalIndexExtractor;

	@Autowired
	private ArticleExtractor articleExtractor;

	private String expectedOutput= "india: 30287717 - 5; " + String.format("%n") +
			"2015: 30287717 - 95; " + String.format("%n") +
			"state: 30287958 - 0, 6, 85; 30288279 - 0, 6, 91; " + String.format("%n") +
			"west: 30287958 - 67; 30288176 - 36; 30288279 - 31, 73; " + String.format("%n") +
			"world: 30288073 - 18; 30288450 - 69, 166; 30288475 - 11; " + String.format("%n") +
			"war: 30288073 - 19; 30288450 - 70, 167;";

	private List<String> lines = Arrays.asList("+------------ NEW ARTICLE ------------+", 
			"30287515: Taipei Municipal Zhong-zheng Senior High School", 
			" Zhong-zheng Senior High School ZZSH or CCSH Traditional Chinese Characters: Hanyu Pinyin: táib i shìlì zh ngzhèng g ozh ng Tongyong Pinyin: taibei shihli jhong jheng gaojhong Wade–Giles: t'aipei shihli chung cheng kaochung is a public 3-year high school in Taipei City Taiwan Republic of China. History Taipei Municipal Zhong-zheng Senior High School formerly the Taipei County Shih-lin Junior High School was established in 1945 and began to enroll new students the next year. The first principal was Mr. Su Jin-zhuan and after the conduct of the following principals Mr. Ho Jiang-shan Mr. Hsieh Da-huang and Ms. Shao Meng-lan this school expanded and developed rapidly and enjoyed growing reputation. In 1964 the senior high school was added on a trial basis and with good results this school was converted into a complete high school in 1966 under the jurisdiction of the Yangmingshan Management Bureau. In 1968 the Yangmingshan Management Bureau was formally taken over by the Taipei City Government. In July this school was separated into two schools—Taipei Municipal Shih-lin Senior High School and Junior High School. By order of the government the campus was assigned as the junior high school in 1972 and the senior high school was moved to the present site Shi-pai on February 25 1975. In August 1975 this school was renamed as Taipei Municipal Zhong-zheng Senior High School. In the same year Ms. Shao Meng-lan announced her retirement. After Ms. Shao were Mr. Yu Wei-lu Ms. Ding Ya-wen and Mr. Lin Shi-de. The current principal Mr. Liu Zheng-ming assumed office in August 2003. Since then Principal Liu has showed great respect for the school faculty students and their parents. Moreover he has spared no effort to handle school affairs with enthusiasm to steer the school into a bright future. Covering a spacious beautiful campus of about 23 000 pings this school was completed with all the necessary facilities in 1975. With the completion of Yi-teh Building in 1987 artistic education was included to help students of talent for arts music and dancing. Our teaching staff is qualified and excellent and so are the students. Together with the school staff students in this school have achieved very good results both in academic performance and in extra-curricular activities. We believe we will make our best endeavors to ensure our school greater success. Location Taipei Municipal Zhong-zheng Senior High School is located in the northwest of the Taipei Basin. See also Education in Taiwan External links Official website Official website ", 
			"+------------ NEW ARTICLE ------------+", 
			"30287600: Potoci", 
			"Potoci South Slavic meaning streams may refer to: Potoci village in Drvar Bosnia and Herzegovina Potoci village in Livno Bosnia and Herzegovina Potoci village in Mostar Bosnia and Herzegovina Potoci former village in Vareš Bosnia and Herzegovina Potoci village in Bicaz Romania Potoci village in Pljevlja Montenegro See also Potok stream Slavic toponym Potoc village in Sasca Montan Romania ", 
			"+------------ NEW ARTICLE ------------+", 
			"30287704: Clínicas (São Paulo Metro)", 
			" Clínicas is a station on Line 2 Green of the São Paulo Metro. ", 
			"+------------ NEW ARTICLE ------------+", 
			"30287717: Delhi Public School, Dhanbad", 
			" Delhi Public School Dhanbad Jharkhand India was established in 1988 in collaboration with Bharat Coking Coal Limited. It is an English medium co-educational school affiliated to the Central Board of Secondary Education New Delhi. This is one of the schools run by the Delhi Public School Society New Delhi a non-profit making society. It was inaugurated by Shri. Salman Khurshid. Its second principal was Col. Retd. B.R. Sharma. The principal is K.B. Bhargava. The vice principal is Sharmila Sinha. The former vice principal was Indrani Ghosh. Location and transport DPS Dhanbad is 6 km from the Dhanbad railway station. It is located in Karmik Nagar in the vicinity of the Indian School of Mines. Smart class is there for classes 1-10. Achievements 43 students secured 10 CGPA in CBSE 10th boards in 2014. 128 students scored 90 in CBSE 12th boards 2015 Ranked No. 1 in Dhanbad district See also Delhi Public School Bokaro Delhi Public School Giridih Carmel School Giridih External links Official website of DPS Dhanbad Official website of DPS Giridih Official website of DPS Bokaro DPS Society DPS Dhanbad's SMS Channel ", 
			"+------------ NEW ARTICLE ------------+", 
			"30287958: Texas State Highway Spur 422", 
			" State Highway Spur 422 Spur 422 is a state highway spur in San Antonio Texas. It is known locally as the Poteet-Jourdanton Freeway. Route description Spur 422 begins at an intersection with Loop 410 and SH 16 near Palo Alto College. Northbound SH 16 follows westbound Loop 410 while northbound Spur 422 continues north along the Poteet-Jourdanton Freeway. The short route ends at an intersection with IH 35. History Spur 422 is a former route of SH 16 and was designated along with Spur 421 in 1965 after SH 16 was rerouted around the west side of San Antonio along the Loop 410 freeway. Major intersections See also List of highways in San Antonio Texas List of state highway spurs in Texas ", 
			"+------------ NEW ARTICLE ------------+", 
			"30287976: Thomas Holt (Australian politician)", 
			" Thomas Holt 14 November 1811 – 5 September 1888 was an Australian pastoralist company director and politician. He was a member of the New South Wales Legislative Council between 1868 and 1883. He was also a member of the New South Wales Legislative Assembly for two periods between 1856 and 1857 and again between 1861 and 1864. Holt was the first Colonial Treasurer in New South Wales. Early life Holt was the son of a Yorkshire wool merchant and was educated in Wakefield. He initially worked in his father's firm in Leeds but after 3 years became a wool buyer in London. Subsequently Holt emigrated to Sydney in 1842 and made a fortune as a wool merchant. He was also a director of numerous colonial companies including the Sydney Railway Company. Holt invested extensively in pastoral land and by 1860 had acquired more than in New South Wales and Queensland. As a result he was independently wealthy and retired from active business in 1855. After building a gothic stone mansion The Warren on land overlooking the Cooks River in Marrickville Holt stocked the grounds with imported European rabbits for breeding and hunting. Animals escaping from this property contributed to the Australian rabbit plague. Holt also had an extensive estate in the Sans Souci area of Sydney. In later life he was a founder of Royal Prince Alfred Hospital a member of the Royal Society of New South Wales and a patron of the Royal Agricultural Society of New South Wales. Colonial Parliament Holt was unsuccessful at two attempts to enter the Legislative Council prior to the establishment of responsible self-government in 1856. However at the first election under the new constitution he was elected to the Legislative Assembly as one of the two members for Stanley Boroughs including Brisbane and Ipswich which prior to the establishment of Queensland as a separate colony in 1859 was part of New South Wales. At the next election in 1858 Holt was defeated in an attempt to transfer to the seat of Cumberland South Riding . He re-entered the Assembly as the member for Newtown at an 1861 by-election caused by the resignation of Alexander McArthur but resigned from the seat before the next election in 1864–65. In 1868 he accepted a life appointment to the Legislative Council. Holt was a supporter of free-trade and had a liberal political philosophy. Throughout his political career he campaigned for education gaol and immigration reform and spent a small fortune supporting Henry Parkes' Empire newspaper. An active Congregationalist in 1864 he gave half the value of his residence Camden Villa towards the founding of Camden College Congregational Church school . Government Holt was New South Wales' inaugural Colonial Treasurer in the liberal government of Stuart Donaldson. He held this position for 81 days. Later life In 1881 Thomas went back to England where he devoted himself to the poor of London working with The Salvation Army the Rev Andrew Mearns author of 'The Bitter Cry of Outcast London: an inquiry into the abject poor' and Dr Barnardo. He died at his home in Bexley on 5 September after completing his book 'Christianity or the Poor Man's Friend' and was buried at Abney Park Cemetery. Legacy The Thomas Holt Retirement Villages are named after him. ", 
			"+------------ NEW ARTICLE ------------+", 
			"30288030: Consolação (São Paulo Metro)", 
			" Consolação is a station on Line 2 Green of the São Paulo Metro. A moving walkway connects to Paulista station on Line 4 Yellow . ", 
			"+------------ NEW ARTICLE ------------+", 
			"30288073: Bruno Freiherr von Brackel", 
			" Bruno Franz Arnold Anton Freiherr von Brackel 20 December 1911 – 13 August 1941 was a highly decorated officer of the Wehrmacht during the Second World War and a recipient of the Knight's Cross of the Iron Cross which was awarded to recognise extreme battlefield bravery or successful military leadership. Brackel was killed on 13 August 1941 near Korsun-Shevchenkivskyi Ukraine. He was posthumously awarded the Knight's Cross of the Iron Cross on 23 August 1941 and promoted Captain Hauptmann . Awards and decorations Iron Cross 1939 2nd Class 23 September 1939 1st Class 9 July 1940 Knight's Cross of the Iron Cross Knight's Cross on 23 August 1941 as Oberleutnant and leader of the 4. / Panzer-Regiment 15 Notes ", 
			"+------------ NEW ARTICLE ------------+", 
			"30288176: Alan Morinis", 
			"Alan Morinis born 1949 is an anthropologist filmmaker and writer who has been a leading figure in the contemporary revival of the Musar movement a Jewish ethical movement. He was trained as an anthropologist as a Rhodes Scholar at Oxford University. His scholarly expertise is in the study of religious pilgrimages especially in Hinduism. He authored the book Pilgrimage in the Hindu Tradition: A Case Study of West Bengal. Morinis was born into a secular Jewish home in Toronto Canada. His later studies in Judaism under the tutelage of Rabbi Yechiel Perr led him to discover the Musar movement a process which he described in his book Climbing Jacob's Ladder. He founded the Mussar Institute based in Vancouver British Columbia. His other books on Musar include Everyday Holiness and Every Day Holy Day. He has been credited as being along with Rabbi Ira F. Stone the leading figure in the contemporary revival of the Musar movement among non-Orthodox Jews. In Climbing Jacob's Ladder Morinis describes the Musar movement as having largely died off after the Holocaust. Some critics however contend that Morinis exaggerates the extent to which the movement died off. Frederic and Mary Ann Brussat of the web site Spirituality Practice have described Morinis's teachings as offering a treasure trove of spiritual practices explications of the practical spiritual tradition of Mussar and insights into how to change your behavior and bring out your soul. Geoffrey Claussen of Elon University has described Morinis as emphasizing the honesty humility patience and discipline that doing Musar requires but as giving less attention to the importance of traditional liturgy and community. ", 
			"+------------ NEW ARTICLE ------------+", 
			"30288279: Texas State Highway Spur 421", 
			" State Highway Spur 421 Spur 421 is a state highway spur in the San Antonio Texas USA metropolitan area. Route description Spur 421 begins at an intersection with IH 10 north of Downtown San Antonio. The route follows Culebra Road to the west before turning to the northwest along Bandera Road. The designation ends at Loop 410 and SH 16 southbound SH 16 follows the Loop 410 freeway while northbound SH 16 continues along Bandera Road. History Spur 421 is a former route of SH 16 and was designated along with Spur 422 in 1965 after SH 16 was rerouted around the west side of San Antonio along the Loop 410 freeway. Major intersections See also List of highways in San Antonio Texas List of state highway spurs in Texas ", 
			"+------------ NEW ARTICLE ------------+", 
			"30288287: Institute for Spatial Policies", 
			" Institute for Spatial Policies Slovene: Inštitut za politike prostora IPoP is an independent research and consultancy as well as non-governmental and non-profit organization active in the field of spatial and urban development. It was established in Ljubljana in 2006 with the aim to integrate knowledge and experience of different sciences and practices dealing with space and place. The institute cooperates with a variety of experts civil society groups and formal institutions in order to develop a network of complementary organizations related to the field of spatial and urban development. In this way the institute tries to create conditions for a common understanding of challenges goals and solutions leading to effective spatial and urban planning. Their work is focused on the processes of producing space and place from a bottom up perspective and emphasizes the importance of long-term thinking participative decision-making processes and sustainable spatial and urban planning. The institute has become a leading non-governmental organization in Slovenia dealing with spatial and urban development. In 2009 the Institute for Spatial Policies started Network for Spatial Development Slovene: Mreža za prostor an initiative aimed to connect and strengthen the role of civil society in spatial and urban planning and related decision-making processes in Slovenia. The initiative was further extended in 2010 in partnership with the Legal Information Centre for the NGOs and Trajekt and now includes more than fifteen member organizations. The institute acts as Slovene URBACT dissemination point together with Trajekt. In 2011 the institute became one of the founding members of the Tabor Cultural Quarter Association Slovene: Kulturna etrt Tabor a civic initiative trying to improve cultural and everyday life in Ljubljana. The institute also organizes Jane's Walk in Slovenia a world-wide community event celebrating the legacy of Jane Jacobs. Notes External links IPoP Institute for Spatial Policies Jane's Walk Tabor Cultural Quarter Association ", 
			"+------------ NEW ARTICLE ------------+", 
			"30288450: Subiaco Academy", 
			" Subiaco Academy is an American Roman Catholic day and boarding school for boys founded in 1928. It is part of Subiaco Abbey a Benedictine monastery in Subiaco Arkansas. History The school came into existence as a result of the German migration to the Arkansas River Valley in the 1870s and especially in the 1880s and 1890s. The Little Rock-Fort Smith Railroad Company had thousands of acres of free land in the area. They had resolved to sell this land only to German Catholic settlers if possible. This company approached the Swiss Benedictine Monks in Indiana to send missionaries to Logan County Arkansas in 1878. These monks brought with them their Swiss Benedictine heritage of a monastery school. Until the First World War numerous additional monks and recruits from Switzerland strengthened this educational tradition. In 1887 the monks opened a school called St. Benedict's College to educate young men between the ages of 14 and 20 in the basic humanities. There were never more than 20 students in this school and it was terminated in the summer of 1892. The monks reorganized this educational project that summer and in the fall the school was reopened as a seminary to train students for the ministry. This school was called The Scholasticate. Modeled upon European Gymnasium lines it consisted mostly of classical languages and musical training. This form of the school reached its peak with some 70 students in 1901 when the institution was largely destroyed by fire. In December 1927 the institution was again destroyed by fire but a primitive school Subiaco Academy was reopened in February 1928 in what was left of the Main Building. This school barely survived the Depression Years. The earliest administrators and teachers were all Benedictine monks. By the time of the First World War there were one or two male lay teachers. Hired coaches were added after the mid-1920s. The great number of non-monk staff teachers and administrators including female faculty members came only in the mid-1970s. Notable alumni John Adams Professional football player for the Washington Redskins Frank Stanford 1966 poet Harvey Wheeler 1937 author political scientist and scholar References External links ", 
			"+------------ NEW ARTICLE ------------+", 
			"30288475: Panda cow", 
			" Panda cow is a breed of miniature cattle with markings that resemble those of a giant panda. There are reportedly only 24 in the world as of January 2011. Also known as the miniature panda cow it is the result of a mutation. its markings include a white belt around the animal's midsection and a white panda-like face with black markings around the eyes. In December 2010 a panda cow was born in Colorado that received a lot of press. In 2013 a miniature Panda Cow was born in Roy Washington. ", 
			"+------------ NEW ARTICLE ------------+", 
			"30288540: List of University of New South Wales faculty", 
			" This is a list of notable University of New South Wales staff. Staff Computer scientists Paul Justin Compton Ripple Down Rules Gernot Heiser operating systems researcher John Lions Unix expert Claude Sammut AI researcher Historians James Franklin Alan Gilbert Alfred McCoy David P. Miller Patrick O'Farrell Legal academics Mark Aronson David Brown Arthur Glass Justice Ronald Sackville George Williams Mathematicians John Blatt Gavin Brown Michael Cowling Matthew England Ian Sloan George Szekeres Norman Wildberger Medical doctors Fred Hollows James Lawson Philosophers Charles Hamblin Genevieve Lloyd David Stove Psychologists John Sweller Others Jeffrey Braithwaite health policy professor Martin Green photovoltaics scientist Tim Harcourt economist Donald Horne political scientist Gordon Parker psychiatrist Andrew Pitman climate scientist John Shine biochemist List of UNSW Staff Administration Chancellors Vice Chancellors Rectors Deputy Rectors");

	@Test
	public void testExtractPositionalIndicesFromArticles() throws IOException
	{
		PlainTextToPositionalIndexExtractorImpl impl = (PlainTextToPositionalIndexExtractorImpl) plainTextToPositionalIndexExtractor;

		Iterator<Article> articleIter = articleExtractor.getArticlesFromLines(lines.iterator()).iterator();
		StringWriter writer = new StringWriter();
		impl.extractPositionalIndicesFromArticles(articleIter, writer);

		String output = writer.toString();
		assertEquals(expectedOutput, output.trim());
	}
}